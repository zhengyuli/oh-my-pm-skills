---
name: qa-engine
description: 质量保证引擎 - 完整性检查、歧义识别、验证问题生成、一致性验证、最佳实践检查
version: 1.0.0
author: oh-my-pm-skills
tags: [engine, qa, validation, completeness-check, ambiguity-detection, review, best-practices]
allowed-tools: Read, Write, Edit
model: inherit
---

# QA Engine

QA (Quality Assurance) 引擎负责自动生成验证问题、检查内容完整性、识别歧义和潜在问题。

## When to Use This Engine

其他技能需要以下功能时调用此引擎：
- 为用户想法生成澄清问题
- 检查 PRD/文档的完整性
- 识别需求中的歧义
- 生成用例的验证问题
- 检查测试覆盖度

## Core Process

### 步骤 1: 分析输入

```yaml
输入类型识别:
  - product_idea: 产品想法/概念
  - requirement: 需求描述
  - user_story: 用户故事
  - prd_draft: PRD 草稿
  - design_doc: 设计文档

分析维度:
  - 完整性: 缺少哪些关键信息
  - 清晰度: 是否有歧义表述
  - 可行性: 技术实现是否明确
  - 一致性: 是否有矛盾之处
```

### 步骤 2: 生成验证问题

根据输入类型和上下文生成问题：

#### 产品想法验证

```yaml
问题类别:
  问题理解:
    - 这个产品要解决的核心问题是什么？
    - 目前用户是如何解决这个问题的？
    - 为什么现有解决方案不够好？

  目标用户:
    - 谁是主要用户？谁是次要用户？
    - 用户的熟练程度如何？
    - 用户在什么场景下使用这个产品？

  验证假设:
    - 如何验证用户确实有这个痛点？
    - 已经做过哪些用户调研？
    - 有哪些数据支持这个想法？

  成功定义:
    - 如何衡量产品是否成功？
    - MVP 的最小功能集是什么？
    - 三个月后的目标是什么？
```

#### 需求验证

```yaml
问题类别:
  需求边界:
    - 这个需求的范围是什么？
    - 明确不在范围内的是什么？
    - 与其他需求的依赖关系？

  验收标准:
    - 如何判断需求已完成？
    - 可以量化吗？
    - 谁来验收？

  技术可行性:
    - 需要哪些技术能力？
    - 有哪些技术风险？
    - 需要多长时间实现？
```

#### PRD 完整性检查

```yaml
必需章节检查:
  - 1. 问题陈述 ✅/❌
  - 2. 目标用户 ✅/❌
  - 3. 目标设定 ✅/❌
  - 4. 用户故事 ✅/❌
  - 5. 功能列表 ✅/❌
  - 6. 非功能需求 ✅/❌
  - 7. 技术规格 ✅/❌
  - 8. 设计要求 ✅/❌
  - 9. 分析指标 ✅/❌
  - 10. 发布计划 ✅/❌
  - 11. 风险评估 ✅/❌

安全增强章节（如适用）:
  - 16. 安全与隐私 ✅/❌
  - 17. 合规与审计 ✅/❌
```

### 步骤 3: 识别问题类型

```yaml
歧义检测:
  模糊词汇:
    - "快速" → 具体是多少？
    - "用户友好" → 具体指什么？
    - "支持" → 功能范围是什么？
    - "优化" → 基准和目标是什么？

  不完整表述:
    - "等" → 具体列出所有项
    - "包括但不限于" → 明确主要项
    - "适当" → 定义标准

矛盾检测:
  - 需求之间的冲突
  - 约束条件的矛盾
  - 时间线的不一致

缺失检测:
  - 未提及的关键角色
  - 缺失的验收标准
  - 未考虑的边界情况
  - 缺少的依赖关系
```

### 步骤 4: 生成问题

#### 优先级排序

```yaml
P0 - 必须澄清:
  - 阻塞理解的核心信息
  - 影响范围极大的决策

P1 - 应该澄清:
  - 重要但非阻塞的信息
  - 影响设计决策的信息

P2 - 可以澄清:
  - 锦上添花的信息
  - 优化级别的细节
```

#### 问题格式

```markdown
## [P0] 问题标题

**背景**: 为什么这个问题很重要

**当前状况**: 描述中有什么不清楚

**建议答案**: 示例或引导

**影响**: 如果不澄清会有什么后果
```

### 步骤 5: 完整性评分

```yaml
评分维度:
  内容完整性: 0-100
  - 核心章节完整度
  - 细节颗粒度
  - 示例充分性

  需求明确性: 0-100
  - 验收标准清晰度
  - 无歧义表述
  - 可测试性

  可执行性: 0-100
  - 技术可行性
  - 资源合理性
  - 时间现实性

总体评分: (内容 + 明确 + 可执行) / 3

评级:
  A (90-100): 可以直接进入开发
  B (75-89): 需要少量澄清
  C (60-74): 需要中等澄清
  D (40-59): 需要大量澄清
  F (0-39): 需要重写
```

## QA API

### 调用格式

```yaml
qa_engine:
  action: "analyze"
  input_type: "product_idea"
  content: |
    [产品想法描述]

  context:
    domain: "[领域]"
    target_users: ["[目标用户]"]

  options:
    priority_levels: ["P0", "P1", "P2"]
    max_questions: 10
    include_completeness_check: true
```

### 返回格式

```yaml
result:
  summary:
    total_questions: 8
    priority_breakdown:
      P0: 3
      P1: 3
      P2: 2
    completeness_score: 45
    grade: "C"

  questions:
    - priority: "P0"
      category: "问题理解"
      question: "用户要分享什么类型的文件？"
      context: "不同文件类型有不同的技术挑战"
      guidance: "例如：文档、图片、视频、代码等"
      impact: "影响存储方案、传输协议选择"

  issues:
    - type: "ambiguity"
      location: "快速分享"
      suggestion: "定义具体的性能指标"

    - type: "missing"
      category: "目标用户"
      suggestion: "明确用户的角色和使用场景"

  recommendations:
    - "补充目标用户画像"
    - "定义文件大小限制"
    - "明确安全要求"
```

## 问题模板库

### 通用 PM 问题

```yaml
产品定位:
  - 这个产品与现有解决方案的核心差异是什么？
  - 为什么现在是做这个产品的时机？
  - 三年后的愿景是什么？

用户验证:
  - 已经与多少潜在用户交谈过？
  - 用户最痛的点是什么？
  - 用户愿意为解决方案付费吗？

商业模式:
  - 如何盈利？
  - 获客成本预计是多少？
  - 留存策略是什么？
```

### 安全专属问题

```yaml
威胁模型:
  - 最关键的资产是什么？
  - 主要的攻击面在哪里？
  - 需要防范哪些威胁？

合规要求:
  - 需要符合哪些合规框架？
  - 有哪些数据保护要求？
  - 审计要求是什么？

安全验证:
  - 如何验证身份？
  - 数据如何加密？
  - 如何检测和响应入侵？
```

## 完整性检查清单

### PRD 检查清单

```markdown
## 内容完整性

- [ ] 问题陈述清晰
- [ ] 目标用户明确
- [ ] 目标可衡量
- [ ] 用户故事有验收标准
- [ ] 功能优先级排序
- [ ] 非功能需求定义
- [ ] 技术约束说明
- [ ] 设计要求包含
- [ ] 成功指标可追踪
- [ ] 发布计划现实

## 需求质量

- [ ] 需求可测试
- [ ] 需求可追溯
- [ ] 无矛盾冲突
- [ ] 无模糊表述
- [ ] 依赖关系明确

## 安全考虑（如适用）

- [ ] 威胁建模完成
- [ ] 安全需求定义
- [ ] 合规要求识别
- [ ] 数据分类明确
- [ ] 隐私影响评估
```

## 最佳实践

核心原则（详见 `shared/common-sections.yaml#best_practices.qa`）：

✅ **DO**:
- 一次问一个相关问题
- 优先处理 P0 问题
- 提供具体的建议和示例

❌ **DON'T**:
- 一次性问太多问题
- 问明显或无关的问题
- 只提问不提供指导

## 集成点

此引擎被以下技能使用：
- **prd-generator**: 生成 PRD 前的澄清问题
- **jtbd-analyzer**: 深挖用户动机的问题
- **threat-modeling**: 威胁建模的验证问题
- **compliance-checker**: 合规检查清单

## 测试示例

```bash
# 分析产品想法
echo '{
  "input_type": "product_idea",
  "content": "做一个AI写代码助手"
}' | qa-engine analyze

# 检查 PRD 完整性
qa-engine check-completeness prd-draft.md

# 生成用户故事问题
echo '{
  "input_type": "user_story",
  "content": "作为开发者，我想要AI帮我写代码"
}' | qa-engine generate-questions
```
